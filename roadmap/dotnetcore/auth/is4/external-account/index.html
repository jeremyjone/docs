<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>外部身份验证 | JeremyJone 的文档站</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/assets/img/logo.png">
    <undefined></undefined>
    <link rel="alternate" type="application/atom+xml" href="https://docs.jeremyjone.com/atom.xml" title="JeremyJone 的文档站 Atom Feed">
    <link rel="alternate" type="application/json" href="https://docs.jeremyjone.com/feed.json" title="JeremyJone 的文档站 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://docs.jeremyjone.com/rss.xml" title="JeremyJone 的文档站 RSS Feed">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="一个快速学习、速查的站点">
    <meta property="og:url" content="/roadmap/dotnetcore/auth/is4/external-account.html">
    <meta property="og:site_name" content="JeremyJone 的文档站">
    <meta property="og:title" content="外部身份验证">
    <meta property="og:description" content="外部身份验证 基于 OAuth2 的特性，我们可以轻松通过外部账户进行登录。 外部账户登录的好处： 方便用户操作。; 将管理登录流程的许多复杂性转移到了第三方。; 添加一个预定义的身份验证 IS4 在 ASP.NET Core 框架的基础上提供了更丰富和完整的预定义外部登录配置。 配置一个 Microsoft 身份验证 下面通过创建一个使用 Microsof">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="JeremyJone 的文档站">
    <meta property="article:author" content="JeremyJone">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="preload" href="/assets/css/0.styles.439caf23.css" as="style"><link rel="preload" href="/assets/js/app.274106fa.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.866ce90b.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.99fc0ed6.js" as="script"><link rel="preload" href="/assets/js/page-外部身份验证.73f45363.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.69314708.js" as="script"><link rel="prefetch" href="/assets/js/134.6d9bab09.js"><link rel="prefetch" href="/assets/js/135.8b6a23ba.js"><link rel="prefetch" href="/assets/js/136.3b4d7965.js"><link rel="prefetch" href="/assets/js/137.1a37cc2f.js"><link rel="prefetch" href="/assets/js/138.c4b55aa4.js"><link rel="prefetch" href="/assets/js/139.8e197c25.js"><link rel="prefetch" href="/assets/js/140.76ac3bad.js"><link rel="prefetch" href="/assets/js/141.bbb85a07.js"><link rel="prefetch" href="/assets/js/layout-Blog.1ed60b76.js"><link rel="prefetch" href="/assets/js/layout-Layout.f3e9cb51.js"><link rel="prefetch" href="/assets/js/layout-NotFound.5a99754f.js"><link rel="prefetch" href="/assets/js/layout-Slide.6887e3cd.js"><link rel="prefetch" href="/assets/js/page--69fb9c74.33b2e2f1.js"><link rel="prefetch" href="/assets/js/page-ASPNETCore开发者学习路线图.1a19bdee.js"><link rel="prefetch" href="/assets/js/page-Android学习之路.36fb99d5.js"><link rel="prefetch" href="/assets/js/page-AutoMapper.6a959fa9.js"><link rel="prefetch" href="/assets/js/page-C.9c4ce895.js"><link rel="prefetch" href="/assets/js/page-CSS基础.842c23e9.js"><link rel="prefetch" href="/assets/js/page-CSS规范.aba418e5.js"><link rel="prefetch" href="/assets/js/page-CSS预处理器.7e77a9ec.js"><link rel="prefetch" href="/assets/js/page-DbContext的配置.85927bb8.js"><link rel="prefetch" href="/assets/js/page-Devtools.3efd332d.js"><link rel="prefetch" href="/assets/js/page-Docker使用文档.a41a1f83.js"><link rel="prefetch" href="/assets/js/page-Docker快速搭建NPM服务器.75c25865.js"><link rel="prefetch" href="/assets/js/page-ExamplePage.feac6b7d.js"><link rel="prefetch" href="/assets/js/page-Flutter学习之路.78c044c0.js"><link rel="prefetch" href="/assets/js/page-GIT命令.c641173c.js"><link rel="prefetch" href="/assets/js/page-GitHubPagesaction配置.d3250601.js"><link rel="prefetch" href="/assets/js/page-HTML基础.329ac737.js"><link rel="prefetch" href="/assets/js/page-HTML处理方法.a4405fb6.js"><link rel="prefetch" href="/assets/js/page-HTML规范.bfb03b5f.js"><link rel="prefetch" href="/assets/js/page-HTTP.1ca6057a.js"><link rel="prefetch" href="/assets/js/page-HTTPS.e8d8a5a4.js"><link rel="prefetch" href="/assets/js/page-Home.80e83b34.js"><link rel="prefetch" href="/assets/js/page-IP网际协议.5fc5c7ff.js"><link rel="prefetch" href="/assets/js/page-IdentityServer4的使用.05f8610f.js"><link rel="prefetch" href="/assets/js/page-JWT.eb3da665.js"><link rel="prefetch" href="/assets/js/page-JavaScript基础.630697c3.js"><link rel="prefetch" href="/assets/js/page-JavaScript开发规范.4a5cc8f9.js"><link rel="prefetch" href="/assets/js/page-Java学习之路.34823b3b.js"><link rel="prefetch" href="/assets/js/page-MVVM.3478b892.js"><link rel="prefetch" href="/assets/js/page-Markdown语法.091706e9.js"><link rel="prefetch" href="/assets/js/page-OSI模型.120cff59.js"><link rel="prefetch" href="/assets/js/page-Proxy与Reflect.feadfcbd.js"><link rel="prefetch" href="/assets/js/page-Python开发规范.7e4e2420.js"><link rel="prefetch" href="/assets/js/page-RabbitMQ的使用.5ebe5a1c.js"><link rel="prefetch" href="/assets/js/page-React学习之路.5ed1c422.js"><link rel="prefetch" href="/assets/js/page-Serilog的使用.0cfcddc8.js"><link rel="prefetch" href="/assets/js/page-Swagger文档的使用.6974b28b.js"><link rel="prefetch" href="/assets/js/page-TCP协议.dd8ac53a.js"><link rel="prefetch" href="/assets/js/page-TypeScript.530b369d.js"><link rel="prefetch" href="/assets/js/page-UDP协议.26768134.js"><link rel="prefetch" href="/assets/js/page-UI框架.e4d414df.js"><link rel="prefetch" href="/assets/js/page-URL.19d23a89.js"><link rel="prefetch" href="/assets/js/page-Vim使用说明.546de0b9.js"><link rel="prefetch" href="/assets/js/page-VueCli.5c3ace72.js"><link rel="prefetch" href="/assets/js/page-VueRouter.b75815de.js"><link rel="prefetch" href="/assets/js/page-VueTestUtils.84077eba.js"><link rel="prefetch" href="/assets/js/page-Vuex.8b059204.js"><link rel="prefetch" href="/assets/js/page-Vue学习之路.f701ff99.js"><link rel="prefetch" href="/assets/js/page-Vue开发规范.d827448a.js"><link rel="prefetch" href="/assets/js/page-class与style的绑定.0e9cb8fa.js"><link rel="prefetch" href="/assets/js/page-npm使用.209e65c5.js"><link rel="prefetch" href="/assets/js/page-this关键字.2b0f2ec8.js"><link rel="prefetch" href="/assets/js/page-七层模型.f35bf254.js"><link rel="prefetch" href="/assets/js/page-万维网.93a2ac96.js"><link rel="prefetch" href="/assets/js/page-从0搭建项目模板（vue3）.293d58fd.js"><link rel="prefetch" href="/assets/js/page-代码书写规范总纲.dcb71d8f.js"><link rel="prefetch" href="/assets/js/page-使用.5bbf8f4f.js"><link rel="prefetch" href="/assets/js/page-使用项目模板.44ede341.js"><link rel="prefetch" href="/assets/js/page-入门.eaa3d2cc.js"><link rel="prefetch" href="/assets/js/page-其他映射工具.1cf13857.js"><link rel="prefetch" href="/assets/js/page-内存缓存.f593377f.js"><link rel="prefetch" href="/assets/js/page-分布式缓存.2bc0dd42.js"><link rel="prefetch" href="/assets/js/page-列组件JGanttColumn.ebed2341.js"><link rel="prefetch" href="/assets/js/page-判断方法.8982ae2c.js"><link rel="prefetch" href="/assets/js/page-前端学习之路.f887cd5c.js"><link rel="prefetch" href="/assets/js/page-前端进阶.1fbf1209.js"><link rel="prefetch" href="/assets/js/page-包管理器.a26e8534.js"><link rel="prefetch" href="/assets/js/page-原型和原型链详解.db6889b6.js"><link rel="prefetch" href="/assets/js/page-原理部分.a9ae9fcf.js"><link rel="prefetch" href="/assets/js/page-响应式与媒体查询.07b5c4d8.js"><link rel="prefetch" href="/assets/js/page-响应式的原理.bb4c44fe.js"><link rel="prefetch" href="/assets/js/page-四层模型.3f0db8ef.js"><link rel="prefetch" href="/assets/js/page-在ASPNET中使用授权与认证.42249ec1.js"><link rel="prefetch" href="/assets/js/page-域名.fe72a48d.js"><link rel="prefetch" href="/assets/js/page-基础知识.92521d0c.js"><link rel="prefetch" href="/assets/js/page-处理日期方法.c23a43a4.js"><link rel="prefetch" href="/assets/js/page-处理颜色的方法.0174ea7e.js"><link rel="prefetch" href="/assets/js/page-学习路线.f8abd2c4.js"><link rel="prefetch" href="/assets/js/page-定位.7104449f.js"><link rel="prefetch" href="/assets/js/page-布局.b2c8dd30.js"><link rel="prefetch" href="/assets/js/page-常用的转换方法.30378a68.js"><link rel="prefetch" href="/assets/js/page-应用性能监控系统.6670cb12.js"><link rel="prefetch" href="/assets/js/page-异步编程.35ec3251.js"><link rel="prefetch" href="/assets/js/page-弹性布局（Flexbox）.dfb48672.js"><link rel="prefetch" href="/assets/js/page-循环渲染.d486d51c.js"><link rel="prefetch" href="/assets/js/page-性能部分.8bc685a0.js"><link rel="prefetch" href="/assets/js/page-手撸代码.21383ed7.js"><link rel="prefetch" href="/assets/js/page-插槽.fe74cdf4.js"><link rel="prefetch" href="/assets/js/page-数据和方法.cc7efb63.js"><link rel="prefetch" href="/assets/js/page-数据库.3359cb05.js"><link rel="prefetch" href="/assets/js/page-数据的持久化（使用数据库）.8386f879.js"><link rel="prefetch" href="/assets/js/page-数据结构.659c398d.js"><link rel="prefetch" href="/assets/js/page-数组的一些扩展方法.6c84330c.js"><link rel="prefetch" href="/assets/js/page-文档手册.329d00a4.js"><link rel="prefetch" href="/assets/js/page-服务容器.bd3fce20.js"><link rel="prefetch" href="/assets/js/page-条件渲染.071e9cc8.js"><link rel="prefetch" href="/assets/js/page-构建工具.9854769b.js"><link rel="prefetch" href="/assets/js/page-栅格布局（Grid）.cbf48045.js"><link rel="prefetch" href="/assets/js/page-根组件JGantt.09a03d40.js"><link rel="prefetch" href="/assets/js/page-格式化工具.80adf0f8.js"><link rel="prefetch" href="/assets/js/page-概述.d2e767f9.js"><link rel="prefetch" href="/assets/js/page-模型.230cadb5.js"><link rel="prefetch" href="/assets/js/page-模板语法.97f3ee01.js"><link rel="prefetch" href="/assets/js/page-渲染.0a0d194e.js"><link rel="prefetch" href="/assets/js/page-滑块组件JGanttSlider.bea52004.js"><link rel="prefetch" href="/assets/js/page-生命周期.c8001439.js"><link rel="prefetch" href="/assets/js/page-生成方法.0809ee29.js"><link rel="prefetch" href="/assets/js/page-盒模型.177ce614.js"><link rel="prefetch" href="/assets/js/page-算法.79f4660e.js"><link rel="prefetch" href="/assets/js/page-管理数据库.bf0784ac.js"><link rel="prefetch" href="/assets/js/page-组件.f16c9c72.js"><link rel="prefetch" href="/assets/js/page-组合式API.73d4de67.js"><link rel="prefetch" href="/assets/js/page-网络基础.50ff39c5.js"><link rel="prefetch" href="/assets/js/page-网络请求.6c61b452.js"><link rel="prefetch" href="/assets/js/page-虚拟DOM.330fce74.js"><link rel="prefetch" href="/assets/js/page-计算属性和侦听器.3f3e6def.js"><link rel="prefetch" href="/assets/js/page-计算机基础.4a19392b.js"><link rel="prefetch" href="/assets/js/page-计算机基础内容.2944a954.js"><link rel="prefetch" href="/assets/js/page-详解认证中心的配置.7efe668f.js"><link rel="prefetch" href="/assets/js/page-跨域.9076a112.js"><link rel="prefetch" href="/assets/js/page-选择器.75a2d3c7.js"><link rel="prefetch" href="/assets/js/page-通用方法.37f3d2f8.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.d68d40c2.js"><link rel="prefetch" href="/assets/js/vendors~valine.292a098c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.439caf23.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="JeremyJone 的文档站" class="logo"> <!----> <span class="site-name can-hide">JeremyJone 的文档站</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">主题色:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码相关菜单" class="dropdown-title"><span class="title"><!---->
        代码相关
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/standard/" class="nav-link"><!---->
  代码编写规范
</a></li><li class="dropdown-item"><a href="/codes/" class="nav-link"><!---->
  手撸代码
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档手册菜单" class="dropdown-title"><span class="title"><!---->
        文档手册
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>使用文档</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/git/" class="nav-link"><!---->
  Git 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/markdown/" class="nav-link"><!---->
  Markdown 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/vim/" class="nav-link"><!---->
  Vim 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/npm/" class="nav-link"><!---->
  npm 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/docker/" class="nav-link"><!---->
  Docker 使用文档
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>学习手册</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/roadmap/base/" class="nav-link"><!---->
  计算机基础
</a></li><li class="dropdown-subitem"><a href="/roadmap/frontend/" class="nav-link"><!---->
  前端学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/dotnetcore/" class="nav-link router-link-active active"><!---->
  .NET 学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/java/" class="nav-link"><!---->
  Java 学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/flutter/" class="nav-link"><!---->
  Flutter 学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/android/" class="nav-link"><!---->
  Android 学习之路
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.jeremyjone.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  我的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.xiaopangying.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  个人站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/jeremyjone/docs" target="_blank" class="repo-link can-hide">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="" role="navigation" class="blogger"><img property="image" alt="Blogger Avatar" src="/assets/img/logo.png" class="avatar round"> <div property="name" class="name">JeremyJone</div> <!----></div> <div class="num-wrapper"><div><div class="num">128</div> <div>文章</div></div> <div><div class="num">0</div> <div>分类</div></div> <div><div class="num">0</div> <div>标签</div></div> <div><div class="num">128</div> <div>时间轴</div></div></div> <!----></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="代码相关菜单" class="dropdown-title"><span class="title"><!---->
      代码相关
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/standard/" class="nav-link"><!---->
  代码编写规范
</a></li><li class="dropdown-item"><!----> <a href="/codes/" class="nav-link"><!---->
  手撸代码
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="文档手册菜单" class="dropdown-title"><span class="title"><!---->
      文档手册
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>使用文档</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/git/" class="nav-link"><!---->
  Git 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/markdown/" class="nav-link"><!---->
  Markdown 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/vim/" class="nav-link"><!---->
  Vim 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/npm/" class="nav-link"><!---->
  npm 使用文档
</a></li><li class="dropdown-subitem"><a href="/document/docker/" class="nav-link"><!---->
  Docker 使用文档
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>学习手册</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/roadmap/base/" class="nav-link"><!---->
  计算机基础
</a></li><li class="dropdown-subitem"><a href="/roadmap/frontend/" class="nav-link"><!---->
  前端学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/dotnetcore/" class="nav-link router-link-active active"><!---->
  .NET 学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/java/" class="nav-link"><!---->
  Java 学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/flutter/" class="nav-link"><!---->
  Flutter 学习之路
</a></li><li class="dropdown-subitem"><a href="/roadmap/android/" class="nav-link"><!---->
  Android 学习之路
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.jeremyjone.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  我的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.xiaopangying.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  个人站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a rel="noopener noreferrer" href="https://github.com/jeremyjone/docs" target="_blank" class="repo-link">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><!----> <span class="title">.NET 学习之路</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/roadmap/dotnetcore/" aria-current="page" class="sidebar-link">ASP.NET Core 开发者学习路线图</a></li><li><a href="/roadmap/dotnetcore/basic/" class="sidebar-link">基础知识</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">依赖注入</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">对象映射</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">认证与授权</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/roadmap/dotnetcore/auth/" aria-current="page" class="sidebar-link">概述</a></li><li><a href="/roadmap/dotnetcore/auth/example/" class="sidebar-link">在 ASP.NET 中使用授权与认证</a></li><li><a href="/roadmap/dotnetcore/auth/jwt/" class="sidebar-link">JWT</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading clickable open"><!----> <span class="title">IdentityServer4</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/roadmap/dotnetcore/auth/is4/" aria-current="page" class="sidebar-link">IdentityServer4 的使用</a></li><li><a href="/roadmap/dotnetcore/auth/is4/useef/" class="sidebar-link">数据的持久化（使用数据库）</a></li><li><a href="/roadmap/dotnetcore/auth/is4/external-account/" aria-current="page" class="active sidebar-link">外部身份验证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#添加一个预定义的身份验证" class="sidebar-link">添加一个预定义的身份验证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#配置一个-microsoft-身份验证" class="sidebar-link heading3">配置一个 Microsoft 身份验证</a></li><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#创建一个新的-microsoft-身份认证客户端" class="sidebar-link heading3">创建一个新的 Microsoft 身份认证客户端</a></li><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#登录测试" class="sidebar-link heading3">登录测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#执行过程" class="sidebar-link">执行过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#登录过程" class="sidebar-link heading3">登录过程</a></li><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#登出过程" class="sidebar-link heading3">登出过程</a></li><li class="sidebar-sub-header"><a href="/roadmap/dotnetcore/auth/is4/external-account/#cookie-的作用" class="sidebar-link heading3">Cookie 的作用</a></li></ul></li></ul></li><li><a href="/roadmap/dotnetcore/auth/is4/intro-config/" class="sidebar-link">详解认证中心的配置</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">缓存</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">日志</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">Swagger 文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">微服务</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/roadmap/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">学习路线</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a href="/roadmap/dotnetcore/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">ASP.NET Core 开发者学习路线图</span></a> <meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a href="/roadmap/dotnetcore/auth/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">概述</span></a> <meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a href="/roadmap/dotnetcore/auth/is4/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">IdentityServer4 的使用</span></a> <meta property="position" content="4"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/roadmap/dotnetcore/auth/is4/external-account/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">外部身份验证</span></a> <meta property="position" content="5"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">外部身份验证</span></h1> <div class="page-info"><!----> <span aria-label="作者🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">JeremyJone</span></span><span aria-label="访问量🔢" data-balloon-pos="down" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/roadmap/dotnetcore/auth/is4/external-account/" data-flag-title="外部身份验证" class="leancloud_visitors"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="写作日期📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-7-2</span></span><!----><!----><span aria-label="阅读时间⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>大约 5 分钟</span> <meta property="timeRequired" content="PT5M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#添加一个预定义的身份验证" class="anchor-link heading2"><div>添加一个预定义的身份验证</div></a></li><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#配置一个-microsoft-身份验证" class="anchor-link heading3"><div>配置一个 Microsoft 身份验证</div></a></li><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#创建一个新的-microsoft-身份认证客户端" class="anchor-link heading3"><div>创建一个新的 Microsoft 身份认证客户端</div></a></li><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#登录测试" class="anchor-link heading3"><div>登录测试</div></a></li><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#执行过程" class="anchor-link heading2"><div>执行过程</div></a></li><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#登录过程" class="anchor-link heading3"><div>登录过程</div></a></li><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#登出过程" class="anchor-link heading3"><div>登出过程</div></a></li><li class="anchor"><a href="/roadmap/dotnetcore/auth/is4/external-account/#cookie-的作用" class="anchor-link heading3"><div>Cookie 的作用</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="外部身份验证"><a href="#外部身份验证" class="header-anchor">#</a> 外部身份验证</h1> <p>基于 OAuth2 的特性，我们可以轻松通过外部账户进行登录。</p> <p>外部账户登录的好处：</p> <ul><li>方便用户操作。</li> <li>将管理登录流程的许多复杂性转移到了第三方。</li></ul> <h2 id="添加一个预定义的身份验证"><a href="#添加一个预定义的身份验证" class="header-anchor">#</a> 添加一个预定义的身份验证</h2> <p>IS4 在 ASP.NET Core 框架的基础上提供了更丰富和完整的预定义外部登录配置。</p> <h3 id="配置一个-microsoft-身份验证"><a href="#配置一个-microsoft-身份验证" class="header-anchor">#</a> 配置一个 Microsoft 身份验证</h3> <p>下面通过创建一个使用 Microsoft 身份进行验证的最小实例来介绍外部验证过程。</p> <div class="custom-block tip"><p class="custom-block-title">示例代码</p> <p>具体代码可以看 <a href="https://github.com/jeremyjone/dotnet-study-road/tree/master/AuthenticationAndAuthorization/AuthenticationAndAuthorization.ExternalAccount" target="_blank" rel="noopener noreferrer">示例代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p>使用命令创建一个全新项目：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>dotnet new is4aspid --name ExternailAccount
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会得到一个完整使用 IS4 的项目，而且已经内置好了 Google 的外部认证。</p> <p>因为我们需要的是 Microsoft 的身份认证，所以需要添加包：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>Microsoft.AspNetCore.Authentication.MicrosoftAccount（3.1.5）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>下载时需要注意版本。</p></div> <p>在 <code>Startup.cs</code> 配置中的认证服务后面追加如下内容：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddGoogle</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>SignInScheme <span class="token operator">=</span> IdentityServerConstants<span class="token punctuation">.</span>ExternalCookieAuthenticationScheme<span class="token punctuation">;</span>

        <span class="token comment">// register your IdentityServer with Google at https://console.developers.google.com</span>
        <span class="token comment">// enable the Google+ API</span>
        <span class="token comment">// set the redirect URI to https://localhost:5001/signin-google</span>
        options<span class="token punctuation">.</span>ClientId <span class="token operator">=</span> <span class="token string">&quot;copy client ID from Google here&quot;</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>ClientSecret <span class="token operator">=</span> <span class="token string">&quot;copy client secret from Google here&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 添加 Microsoft 认证</span>
    <span class="token punctuation">.</span><span class="token function">AddMicrosoftAccount</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft&quot;</span><span class="token punctuation">,</span> options <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>SignInScheme <span class="token operator">=</span> IdentityServerConstants<span class="token punctuation">.</span>ExternalCookieAuthenticationScheme<span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>ClientId <span class="token operator">=</span> <span class="token string">&quot;microsoft_client_id&quot;</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>ClientSecret <span class="token operator">=</span> <span class="token string">&quot;microsoft_client_secret&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>运行项目，已经可以看到登录按钮。</p> <img src="/assets/roadmap/dotnet/is4_external_ms.png" alt="is4_external_ms"> <p>如果你的 Id 和 Secret 配置正确，现在已经可以正常登录了。没错，就是这么简单的使用。但是如果没有配置相应的 Id 和 Secret，没关系，按照下面步骤操作即可。</p> <h3 id="创建一个新的-microsoft-身份认证客户端"><a href="#创建一个新的-microsoft-身份认证客户端" class="header-anchor">#</a> 创建一个新的 Microsoft 身份认证客户端</h3> <p>打开 <a href="https://go.microsoft.com/fwlink/?linkid=2083908" target="_blank" rel="noopener noreferrer">应用注册页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这是 Microsoft 的 Azure 门户，我们开发的客户端需要在这里注册。登录 Microsoft 账户后即可看到主页面。</p> <h4 id="注册客户端"><a href="#注册客户端" class="header-anchor">#</a> 注册客户端</h4> <ul><li>选择左上角的 <strong>新注册</strong>。</li></ul> <img src="/assets/roadmap/dotnet/is4_external_ms_azurepage.png" alt="is4_external_ms_azurepage"> <ul><li>输入 “名称”。</li> <li>为 <strong>支持的账户类型</strong> 选择一个选项（如果不是组织，一定选择下面两项包含个人的）。</li> <li>在 <strong>重定向 URI</strong> 中输入开发的 URL 并追加 <code>/signin-microsoft</code>。</li></ul> <img src="/assets/roadmap/dotnet/is4_external_ms_azure_register.png" alt="is4_external_ms_azure_register"> <ul><li>最后点击 <strong>注册</strong> 即可。</li></ul> <h4 id="添加秘钥"><a href="#添加秘钥" class="header-anchor">#</a> 添加秘钥</h4> <ul><li>选择左侧的 <strong>证书和密码</strong>。</li></ul> <img src="/assets/roadmap/dotnet/is4_external_ms_azure_registed.png" alt="is4_external_ms_azure_registed"> <ul><li>在 <strong>客户端密码</strong> 下面选择 <strong>新的客户端密码</strong>。</li> <li>添加客户端密码的说明并选择有效期，然后点击 <strong>添加</strong>。</li> <li>复制 <strong>客户端秘钥</strong> 的 <strong>值</strong> 与 <strong>ID</strong>。（一定要复制 <strong>值</strong>，离开了页面再打开就不能查看和复制该值了）</li></ul> <img src="/assets/roadmap/dotnet/is4_external_ms_azure_create_secret.png" alt="is4_external_ms_azure_create_secret"> <h3 id="登录测试"><a href="#登录测试" class="header-anchor">#</a> 登录测试</h3> <p>有了 ID 和秘钥，添加到我们的代码中，再次运行，已经可以登录该客户端了。</p> <img src="/assets/roadmap/dotnet/is4_external_ms_azure_login.png" alt="is4_external_ms_azure_login"> <h2 id="执行过程"><a href="#执行过程" class="header-anchor">#</a> 执行过程</h2> <h3 id="登录过程"><a href="#登录过程" class="header-anchor">#</a> 登录过程</h3> <p>整个外部验证的流程是从点击登录按钮开始的。</p> <p>1、看 <code>Login.cshtml</code> 页面的代码，点击按钮后会定向到 <code>Login</code> URI，因为是配置的外部登录信息，所以会包含对应的 <code>scheme</code> 和 <code>returnUrl</code> 信息，这是页面写好的。</p> <p>2、当控制器收到请求之后，检查这是一个外部验证请求，于是跳转到 <code>Challenge</code> Action 中，
它会触发身份验证处理程序，通过 <code>HttpContext</code> 中的 <code>ChallengeAsync</code> 或者是 MVC 项目中的 <code>ChallengeResult</code> 来调用外部身份验证处理程序。</p> <p>3、回调接收，通过定义好的 <code>RedirectUri</code>，可以在完成验证之后调转到指定接收器。剩下的事情就是在回调方法中添加需要的内容即可。典型的任务如：</p> <ul><li>检查外部提供者返回的身份</li> <li>决定如何与该用户进行交互，新、老用户的区别等</li> <li>新用户如何才被允许</li> <li>是否需要创建本地账户并关联到外部账户</li> <li>存储需要保留的外部声明</li> <li>删除临时 Cookie</li> <li>登录用户</li></ul> <h3 id="登出过程"><a href="#登出过程" class="header-anchor">#</a> 登出过程</h3> <p>用户登出时，通常被重定向至外部程序进行登出，但是并不是所有外部程序都支持登出，这取决于它们的协议和特性。</p> <p>要检测用户必须重定向到外部标识提供者以进行登出，通常可以使用 IdentityServer 上发布到 Cookie 中的 idp 声明。声明中设置的值是对应的认证中间件的 AuthenticationScheme。在登出时，会咨询该声明以了解是否需要外部登出。</p> <p>由于正常的登出工作流已经需要清理和状态管理，将用户重定向到外部身份提供程序是有问题的。然后，在 IdentityServer 上完成正常的登出和清理过程的唯一方法是，在用户注销后，从外部标识提供者请求将用户重定向回 IdentityServer。</p> <p>登出后撤销 IdentityServer 的身份验证的 Cookie，然后重定向到请求注销后外部程序的重定向链接。登出后应该维护必要的登出状态，要在外部程序登出后重定向回 IdentityServer，当使用 SignOut 时，RedirectUri 应该在 AuthenticationProperties 中使用：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateAntiForgeryToken</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Logout</span><span class="token punctuation">(</span><span class="token class-name">LogoutInputModel</span> model<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>TriggerExternalSignout<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// build a return URL so the upstream provider will redirect back</span>
        <span class="token comment">// to us after the user has logged out. this allows us to then</span>
        <span class="token comment">// complete our single sign-out processing.</span>
        <span class="token class-name"><span class="token keyword">string</span></span> url <span class="token operator">=</span> Url<span class="token punctuation">.</span><span class="token function">Action</span><span class="token punctuation">(</span><span class="token string">&quot;Logout&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> logoutId <span class="token operator">=</span> vm<span class="token punctuation">.</span>LogoutId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// this triggers a redirect to the external provider for sign-out</span>
        <span class="token keyword">return</span> <span class="token function">SignOut</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthenticationProperties</span> <span class="token punctuation">{</span> RedirectUri <span class="token operator">=</span> url <span class="token punctuation">}</span><span class="token punctuation">,</span> vm<span class="token punctuation">.</span>ExternalAuthenticationScheme<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="cookie-的作用"><a href="#cookie-的作用" class="header-anchor">#</a> Cookie 的作用</h3> <p>在上面示例中，我们的 <code>SignInScheme</code> 是 Cookie 的方式：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>options<span class="token punctuation">.</span>SignInScheme <span class="token operator">=</span> IdentityServerConstants<span class="token punctuation">.</span>ExternalCookieAuthenticationScheme<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>该 Cookie 将临时存储外部身份验证的结果，这是必要的，因为在过程完成之前，通常都会设计几个重定向。鉴于这是一种通常的做法，IS4 专门为一些外部程序注册了 Cookie 处理程序，通过上面代码的常量表示。</p> <p>但是也可以使用自定义的方式：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddCookie</span><span class="token punctuation">(</span><span class="token string">&quot;CustomCookieScheme&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddMicrosoftAccount</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft&quot;</span><span class="token punctuation">,</span> options <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>SignInScheme <span class="token operator">=</span> <span class="token string">&quot;CustomCookieScheme&quot;</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>ClientId <span class="token operator">=</span> <span class="token string">&quot;microsoft_client_id&quot;</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>ClientSecret <span class="token operator">=</span> <span class="token string">&quot;microsoft_client_secret&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对于特殊情况，还可以使外部 Cookie 机制短路，直接将外部用户转发到主 Cookie 处理程序，来确保外部标识源进行正确的声明转换。</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/jeremyjone/docs/edit/main/docs/roadmap/dotnetcore/auth/is4/external-account.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2022年7月2日 11:31</span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/roadmap/dotnetcore/auth/is4/useef/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        数据的持久化（使用数据库）
      </a></span> <span class="next"><a href="/roadmap/dotnetcore/auth/is4/intro-config/">
        详解认证中心的配置
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <div class="comments-wrapper"><div class="valine-wrapper"><div id="valine"></div></div></div> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><a href='https://beian.miit.gov.cn/' target='_blank'>京ICP备19012859号-1</a></div> <div class="copyright">MIT Licensed | Copyright © 2020-present <a href="https://www.jeremyjone.com" target="_blank">JeremyJone</a></div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="关闭" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">该应用可以安装在您的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和您的操作系统安全地进行交互。</p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>详情</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        安装 <span></span></button> <button class="cancel-button">
        取消
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.274106fa.js" defer></script><script src="/assets/js/vendors~layout-Layout.866ce90b.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.99fc0ed6.js" defer></script><script src="/assets/js/page-外部身份验证.73f45363.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.69314708.js" defer></script>
  </body>
</html>
