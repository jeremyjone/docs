(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{385:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"github-pages-action-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-pages-action-配置"}},[t._v("#")]),t._v(" GitHub Pages action 配置")]),t._v(" "),a("p",[t._v("GitHub 给我们提供了非常方便的部署功能 "),a("a",{attrs:{href:"https://github.com/marketplace/actions/github-pages-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Pages action"),a("OutboundLink")],1),t._v("。它可以帮助我们快速部署静态页面，省去了每次单独部署的繁琐操作，我们只需要通过简单的配置就可以实现该功能。")]),t._v(" "),a("p",[t._v("我们以该 vuepress 文档为例。")]),t._v(" "),a("h2",{attrs:{id:"添加工作流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加工作流"}},[t._v("#")]),t._v(" 添加工作流")]),t._v(" "),a("p",[t._v("首先在项目中添加工作流文件："),a("code",[t._v(".github/workflows/gh-pages.yml")]),t._v("，"),a("code",[t._v("yml")]),t._v(" 文件名可以是任意名称。")]),t._v(" "),a("p",[t._v("这里我们用一个比较通用的解决方案 "),a("code",[t._v("peaceiris/actions-gh-pages@v3")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build and Deploy "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工作流名称。可选，任意填写")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定自动触发工作流程的事件")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定触发事件的分支")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-and-deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作业名称。任意填写")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行环境")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("concurrency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 并发设置。确保只有使用相同并发组的单一作业或工作流才会同时运行")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" github.workflow "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" github.ref "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 并发组名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作业步骤")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检索仓库并将其下载到运行器。只要工作流针对仓库的代码运行，都必须使用检出操作")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Setup Node.js $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env.NODE_VERSION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装指定版本的 node 包。这步之后可以使用 npm 命令")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env.NODE_VERSION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定版本。 env 是当前环境变量，它随作业步骤改变而改变")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yarn "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装依赖")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yarn docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("build "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打包")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤名称")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peaceiris/actions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages@v3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将指定内容发布到 gh-pages 分支")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" github.ref == 'refs/heads/docs' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 确保当前分支为 docs 才执行下面内容")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publish_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./docs/.vuepress/dist "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件目录")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github_token")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITHUB_TOKEN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自动创建 GITHUB_TOKEN")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.ACTIONS_DEPLOY_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 秘钥 SSH Deploy Key。生成和配置方法看下面")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commit_message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Update docs "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 提交信息，任意填写")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br")])]),a("p",[t._v("配置好之后，就可以上传我们的代码，现在 GitHub 就可以根据我们的需求进行自动化部署了。")]),t._v(" "),a("h2",{attrs:{id:"解构文件内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解构文件内容"}},[t._v("#")]),t._v(" 解构文件内容")]),t._v(" "),a("p",[t._v("下面我们一点一点解读配置文件。也可以阅读 "),a("a",{attrs:{href:"https://docs.github.com/cn/actions/learn-github-actions/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v("，这里更加全面和详细。")]),t._v(" "),a("p",[t._v("我们的目标是每当我们 push 文档内容到 github，都会自动构建静态页面。")]),t._v(" "),a("p",[t._v("将上面事件内容模型化："),a("strong",[t._v("每当有预期事件发生，就会执行指定任务。")])]),t._v(" "),a("p",[t._v("所以我们可以通过上面 "),a("code",[t._v("yml")]),t._v(" 文件看出：")]),t._v(" "),a("ul",[a("li",[t._v("每当有事件符合触发条件 "),a("code",[t._v("on")]),t._v("，就会执行作业 "),a("code",[t._v("jobs")]),t._v("。")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/assets/pic/overview-actions-simple.png"),alt:""}}),t._v(" "),a("h3",{attrs:{id:"名称-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#名称-name"}},[t._v("#")]),t._v(" 名称 name")]),t._v(" "),a("p",[t._v("设置工作流程的名称。GitHub 在仓库的操作页面上显示工作流程的名称。如果省略 "),a("code",[t._v("name")]),t._v("，GitHub 将其设置为相对于仓库根目录的工作流程文件路径。")]),t._v(" "),a("h3",{attrs:{id:"触发条件-on"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#触发条件-on"}},[t._v("#")]),t._v(" 触发条件 on")]),t._v(" "),a("p",[t._v("所以我们需要定义一个触发条件，也就是 "),a("code",[t._v("on")]),t._v("。这是一个 "),a("strong",[t._v("必填")]),t._v(" 内容。可以提供单一事件 "),a("code",[t._v("string")]),t._v("，事件的 "),a("code",[t._v("array")]),t._v("，或者事件 "),a("code",[t._v("types")]),t._v(" 的 "),a("code",[t._v("array")]),t._v(" 甚至是事件配置 "),a("code",[t._v("map")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" push\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pull_request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" main\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pull_request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" main\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("page_build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("release")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("types")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" created\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("p",[t._v("更多内容，可以参考 "),a("a",{attrs:{href:"https://docs.github.com/cn/actions/learn-github-actions/events-that-trigger-workflows",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"作业-jobs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作业-jobs"}},[t._v("#")]),t._v(" 作业 jobs")]),t._v(" "),a("p",[t._v("工作流运行包括一项或多项作业。默认为并行作业。")]),t._v(" "),a("p",[t._v("每个作业在 "),a("code",[t._v("runs-on")]),t._v(" 指定的运行器环境中运行。")]),t._v(" "),a("p",[t._v("作业的配置内容十分丰富，可以参考 "),a("a",{attrs:{href:"https://docs.github.com/cn/actions/learn-github-actions/workflow-syntax-for-github-actions#jobs",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v(" 仔细阅读。")]),t._v(" "),a("h4",{attrs:{id:"github-上下文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-上下文"}},[t._v("#")]),t._v(" github 上下文")]),t._v(" "),a("p",[a("code",[t._v("github")]),t._v(" 上下文包含有关工作流运行并触发运行事件的信息，可以通过读取上下文内容获取大部分数据。具体参照 "),a("a",{attrs:{href:"https://docs.github.com/en/actions/learn-github-actions/contexts#github-context",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("例如，我们在配置中用到的：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("github.workflow")]),t._v("：工作流名称。如果工作流文件未指定名称，则默认为工作流文件的完整路径。")]),t._v(" "),a("li",[a("code",[t._v("github.ref")]),t._v("：出发工作流运行的分支或标记。"),a("code",[t._v("refs/heads/<branch_name>")]),t._v(" 或 "),a("code",[t._v("refs/tags/<tag_name>")])])]),t._v(" "),a("h2",{attrs:{id:"添加-ssh-deploy-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加-ssh-deploy-key"}},[t._v("#")]),t._v(" 添加 SSH Deploy Key")]),t._v(" "),a("p",[t._v("我们在部署时需要用到 "),a("code",[t._v("deploy key")]),t._v("，如果没有，则会报找不到 "),a("code",[t._v("key")]),t._v(" 的错误。")]),t._v(" "),a("p",[t._v("在上面 "),a("code",[t._v("yml")]),t._v(" 文件中我们用到：")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.ACTIONS_DEPLOY_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("名称可以随意起。")]),t._v(" "),a("h3",{attrs:{id:"生成-ssh-deploy-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成-ssh-deploy-key"}},[t._v("#")]),t._v(" 生成 SSH Deploy Key")]),t._v(" "),a("p",[t._v("通过命令在本地生成一个 "),a("code",[t._v("deploy key")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("ssh-keygen -t rsa -b "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" -C "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" config user.email"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v(" -f gh-pages -N "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以在当前路径下得到两个文件:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   gh-pages.pub (public key)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   gh-pages     (private key)")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("执行上面命令时，"),a("code",[t._v("Windows")]),t._v(" 用户不要使用 "),a("code",[t._v("PowerShell")]),t._v("，需要使用 "),a("code",[t._v("Git Bash")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"应用-ssh-deploy-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用-ssh-deploy-key"}},[t._v("#")]),t._v(" 应用 SSH Deploy Key")]),t._v(" "),a("p",[t._v("到 GitHub 仓库的 "),a("code",[t._v("settings")]),t._v(" 页面：")]),t._v(" "),a("ul",[a("li",[t._v("转到 "),a("code",[t._v("Deploy Keys")]),t._v(" 页面并添加新 "),a("code",[t._v("key")]),t._v("：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("添加路径")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("添加 public key")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("添加成功")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/jeremyjone/docs/blob/docs/docs/.vuepress/public/assets/pic/github_workflow_add_deploy_key1.png",target:"_blank"}},[a("img",{attrs:{src:t.$withBase("/assets/pic/github_workflow_add_deploy_key1.png"),alt:""}})])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/jeremyjone/docs/blob/docs/docs/.vuepress/public/assets/pic/github_workflow_add_deploy_key2.png",target:"_blank"}},[a("img",{attrs:{src:t.$withBase("/assets/pic/github_workflow_add_deploy_key2.png"),alt:""}})])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/jeremyjone/docs/blob/docs/docs/.vuepress/public/assets/pic/github_workflow_add_deploy_key3.png",target:"_blank"}},[a("img",{attrs:{src:t.$withBase("/assets/pic/github_workflow_add_deploy_key3.png"),alt:""}})])])])])]),t._v(" "),a("ul",[a("li",[t._v("转到 "),a("code",[t._v("Secrets")]),t._v(" 页面并添加新 "),a("code",[t._v("secret")]),t._v("：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("添加路径")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("添加 private key")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("添加成功")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/jeremyjone/docs/blob/docs/docs/.vuepress/public/assets/pic/github_workflow_add_secret_key1.png",target:"_blank"}},[a("img",{attrs:{src:t.$withBase("/assets/pic/github_workflow_add_secret_key1.png"),alt:""}})])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/jeremyjone/docs/blob/docs/docs/.vuepress/public/assets/pic/github_workflow_add_secret_key2.png",target:"_blank"}},[a("img",{attrs:{src:t.$withBase("/assets/pic/github_workflow_add_secret_key2.png"),alt:""}})])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("a",{attrs:{href:"https://github.com/jeremyjone/docs/blob/docs/docs/.vuepress/public/assets/pic/github_workflow_add_secret_key3.png",target:"_blank"}},[a("img",{attrs:{src:t.$withBase("/assets/pic/github_workflow_add_secret_key3.png"),alt:""}})])])])])]),t._v(" "),a("blockquote",[a("p",[t._v("注意，需要记住填写的私钥名称，这个需要用在 "),a("code",[t._v("secrets.ACTIONS_DEPLOY_KEY")]),t._v(" 中。")])])])}),[],!1,null,null,null);s.default=n.exports}}]);